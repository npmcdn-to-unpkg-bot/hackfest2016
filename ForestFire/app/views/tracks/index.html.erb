<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Quick Start Guide Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
</head>
<body>

  <%= @track.area_name %>
	<div id="mapid" style="width: 100%; height:40vh"></div>

	<script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
	<script>
		var mymap = L.map('mapid').setView([-41.28545, 174.77403], 16);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY2RlaWdodG9uIiwiYSI6ImNpczJrNGV6dDAxM3gyemxrNWlzd3Njbm8ifQ.vv_McJTtMa2DmJNmDVypNA', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}).addTo(mymap);

    L.marker([-41.28545, 174.77403]).addTo(mymap);

		L.polygon([
			[-41.38545, 174.77403],
			[-41.28545, 174.67403],
			[-41.38545, 174.77403]
		]).addTo(mymap).bindPopup("I am a polygon.");
	</script>

	<script type="text/javascript">

		// XXX: lat and lon may be around the wrong way on the database.
		var url = "https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=6d26b3085b2ce2e5d8f6400c044792df&lat=" + 
				<%= @track.coordinates[0].longitude.to_s %> + "&lon=" + <%= @track.coordinates[0].latitude.to_s %> + "&radius=0.03&format=json&nojsoncallback=1";

		$.getJSON(url, 
			function(result) {
				
				// console.log(url);
				// console.log(result);

				$("span.test").html(result.photos.photo[0].title); 

				var photo1 = result.photos.photo[0];

				var image_url = "https:\/\/farm" + photo1.farm + ".staticflickr.com\/" + photo1.server + "\/" + photo1.id + "_" + photo1.secret + ".jpg";

				// image_url format
				// "https:\/\/farm9.staticflickr.com\/8102\/8475556512_beca454079.jpg"

				// Set that image shit maaaaaannn
				document.getElementById("image1").src = image_url;
			})

	</script>

	<div data-role="main" class="ui-content">
		<span class="test"> </span>
	</div>		

	<img id="image1" src="" </img>

</body>
</html>
